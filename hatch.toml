[envs.default]
dependencies = [
    # NOTE: To run all hooks
    "pre-commit",
    # NOTE: towncrier for changelog
    "towncrier",
    # NOTE: Using under ./tools/update-optional-dependencies.py
    "tomlkit",
    # NOTE: Using under ./tools/update-readme.py
    "markdown-it-py",
    # NOTE: pyright for type
    "pyright",
]
[envs.default.scripts]
changelog = "towncrier build --version main --draft"
fmt = "pre-commit run --all-files"
setup = "pre-commit install"
typing = "pyright {args:src/openllm tests}"
[envs.test]
dependencies = [
    # NOTE: Tests strategies with Hypothesis and pytest, and snapshot testing with syrupy
    "coverage[toml]>=6.5",
    "lxml",
    "pytest",
    "pytest-asyncio>=0.21.0",
    "pytest-xdist[psutil]",
    "pytest-cov",
    "pytest-mock",
    "pytest-randomly",
    "pytest-rerunfailures",
    "hypothesis",
    "syrupy",
]
[envs.test.overrides]
env.GITHUB_ACTIONS.env-vars = "COVERAGE_REPORT="
env.HERMETIC_TESTS.type = [{ value = "container", if = ["true"] }, "virtual"]
[envs.test.scripts]
_run_script = "pytest --cov --cov-report={env:COVERAGE_REPORT:term-missing} --cov-config=pyproject.toml"
full = "_run_script -n 3  --reruns 5 --reruns-delay 3 -r aR {args:tests}"
[[envs.test.matrix]]
python = ["3.8", "3.9", "3.10", "3.11"]
[envs.coverage]
dependencies = ["coverage[toml]>=6.5", "lxml", "orjson"]
detached = true
[envs.coverage.scripts]
combine = "coverage combine {args}"
generate-summary = "python tools/generate-coverage.py"
report-uncovered-html = "coverage html --skip-covered --skip-empty"
report-xml = "coverage xml"
write-summary-report = "python tools/write-coverage-report.py"
